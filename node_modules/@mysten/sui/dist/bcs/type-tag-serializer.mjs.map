{"version":3,"file":"type-tag-serializer.mjs","names":[],"sources":["../../src/bcs/type-tag-serializer.ts"],"sourcesContent":["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { splitGenericParameters } from '@mysten/bcs';\n\nimport { normalizeSuiAddress } from '../utils/sui-types.js';\nimport type { TypeTag } from './types.js';\n\nconst VECTOR_REGEX = /^vector<(.+)>$/;\nconst STRUCT_REGEX = /^([^:]+)::([^:]+)::([^<]+)(<(.+)>)?/;\n\nexport class TypeTagSerializer {\n\tstatic parseFromStr(str: string, normalizeAddress = false): TypeTag {\n\t\tif (str === 'address') {\n\t\t\treturn { address: null };\n\t\t} else if (str === 'bool') {\n\t\t\treturn { bool: null };\n\t\t} else if (str === 'u8') {\n\t\t\treturn { u8: null };\n\t\t} else if (str === 'u16') {\n\t\t\treturn { u16: null };\n\t\t} else if (str === 'u32') {\n\t\t\treturn { u32: null };\n\t\t} else if (str === 'u64') {\n\t\t\treturn { u64: null };\n\t\t} else if (str === 'u128') {\n\t\t\treturn { u128: null };\n\t\t} else if (str === 'u256') {\n\t\t\treturn { u256: null };\n\t\t} else if (str === 'signer') {\n\t\t\treturn { signer: null };\n\t\t}\n\n\t\tconst vectorMatch = str.match(VECTOR_REGEX);\n\t\tif (vectorMatch) {\n\t\t\treturn {\n\t\t\t\tvector: TypeTagSerializer.parseFromStr(vectorMatch[1], normalizeAddress),\n\t\t\t};\n\t\t}\n\n\t\tconst structMatch = str.match(STRUCT_REGEX);\n\t\tif (structMatch) {\n\t\t\tconst address = normalizeAddress ? normalizeSuiAddress(structMatch[1]) : structMatch[1];\n\t\t\treturn {\n\t\t\t\tstruct: {\n\t\t\t\t\taddress,\n\t\t\t\t\tmodule: structMatch[2],\n\t\t\t\t\tname: structMatch[3],\n\t\t\t\t\ttypeParams:\n\t\t\t\t\t\tstructMatch[5] === undefined\n\t\t\t\t\t\t\t? []\n\t\t\t\t\t\t\t: TypeTagSerializer.parseStructTypeArgs(structMatch[5], normalizeAddress),\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tthrow new Error(`Encountered unexpected token when parsing type args for ${str}`);\n\t}\n\n\tstatic parseStructTypeArgs(str: string, normalizeAddress = false): TypeTag[] {\n\t\treturn splitGenericParameters(str).map((tok) =>\n\t\t\tTypeTagSerializer.parseFromStr(tok, normalizeAddress),\n\t\t);\n\t}\n\n\tstatic tagToString(tag: TypeTag): string {\n\t\tif ('bool' in tag) {\n\t\t\treturn 'bool';\n\t\t}\n\t\tif ('u8' in tag) {\n\t\t\treturn 'u8';\n\t\t}\n\t\tif ('u16' in tag) {\n\t\t\treturn 'u16';\n\t\t}\n\t\tif ('u32' in tag) {\n\t\t\treturn 'u32';\n\t\t}\n\t\tif ('u64' in tag) {\n\t\t\treturn 'u64';\n\t\t}\n\t\tif ('u128' in tag) {\n\t\t\treturn 'u128';\n\t\t}\n\t\tif ('u256' in tag) {\n\t\t\treturn 'u256';\n\t\t}\n\t\tif ('address' in tag) {\n\t\t\treturn 'address';\n\t\t}\n\t\tif ('signer' in tag) {\n\t\t\treturn 'signer';\n\t\t}\n\t\tif ('vector' in tag) {\n\t\t\treturn `vector<${TypeTagSerializer.tagToString(tag.vector)}>`;\n\t\t}\n\t\tif ('struct' in tag) {\n\t\t\tconst struct = tag.struct;\n\t\t\tconst typeParams = struct.typeParams.map(TypeTagSerializer.tagToString).join(', ');\n\t\t\treturn `${struct.address}::${struct.module}::${struct.name}${\n\t\t\t\ttypeParams ? `<${typeParams}>` : ''\n\t\t\t}`;\n\t\t}\n\t\tthrow new Error('Invalid TypeTag');\n\t}\n}\n\nexport function normalizeTypeTag(type: string): string {\n\treturn TypeTagSerializer.tagToString(TypeTagSerializer.parseFromStr(type));\n}\n"],"mappings":";;;;AAQA,MAAM,eAAe;AACrB,MAAM,eAAe;AAErB,IAAa,oBAAb,MAAa,kBAAkB;CAC9B,OAAO,aAAa,KAAa,mBAAmB,OAAgB;AACnE,MAAI,QAAQ,UACX,QAAO,EAAE,SAAS,MAAM;WACd,QAAQ,OAClB,QAAO,EAAE,MAAM,MAAM;WACX,QAAQ,KAClB,QAAO,EAAE,IAAI,MAAM;WACT,QAAQ,MAClB,QAAO,EAAE,KAAK,MAAM;WACV,QAAQ,MAClB,QAAO,EAAE,KAAK,MAAM;WACV,QAAQ,MAClB,QAAO,EAAE,KAAK,MAAM;WACV,QAAQ,OAClB,QAAO,EAAE,MAAM,MAAM;WACX,QAAQ,OAClB,QAAO,EAAE,MAAM,MAAM;WACX,QAAQ,SAClB,QAAO,EAAE,QAAQ,MAAM;EAGxB,MAAM,cAAc,IAAI,MAAM,aAAa;AAC3C,MAAI,YACH,QAAO,EACN,QAAQ,kBAAkB,aAAa,YAAY,IAAI,iBAAiB,EACxE;EAGF,MAAM,cAAc,IAAI,MAAM,aAAa;AAC3C,MAAI,YAEH,QAAO,EACN,QAAQ;GACP,SAHc,mBAAmB,oBAAoB,YAAY,GAAG,GAAG,YAAY;GAInF,QAAQ,YAAY;GACpB,MAAM,YAAY;GAClB,YACC,YAAY,OAAO,SAChB,EAAE,GACF,kBAAkB,oBAAoB,YAAY,IAAI,iBAAiB;GAC3E,EACD;AAGF,QAAM,IAAI,MAAM,2DAA2D,MAAM;;CAGlF,OAAO,oBAAoB,KAAa,mBAAmB,OAAkB;AAC5E,SAAO,uBAAuB,IAAI,CAAC,KAAK,QACvC,kBAAkB,aAAa,KAAK,iBAAiB,CACrD;;CAGF,OAAO,YAAY,KAAsB;AACxC,MAAI,UAAU,IACb,QAAO;AAER,MAAI,QAAQ,IACX,QAAO;AAER,MAAI,SAAS,IACZ,QAAO;AAER,MAAI,SAAS,IACZ,QAAO;AAER,MAAI,SAAS,IACZ,QAAO;AAER,MAAI,UAAU,IACb,QAAO;AAER,MAAI,UAAU,IACb,QAAO;AAER,MAAI,aAAa,IAChB,QAAO;AAER,MAAI,YAAY,IACf,QAAO;AAER,MAAI,YAAY,IACf,QAAO,UAAU,kBAAkB,YAAY,IAAI,OAAO,CAAC;AAE5D,MAAI,YAAY,KAAK;GACpB,MAAM,SAAS,IAAI;GACnB,MAAM,aAAa,OAAO,WAAW,IAAI,kBAAkB,YAAY,CAAC,KAAK,KAAK;AAClF,UAAO,GAAG,OAAO,QAAQ,IAAI,OAAO,OAAO,IAAI,OAAO,OACrD,aAAa,IAAI,WAAW,KAAK;;AAGnC,QAAM,IAAI,MAAM,kBAAkB;;;AAIpC,SAAgB,iBAAiB,MAAsB;AACtD,QAAO,kBAAkB,YAAY,kBAAkB,aAAa,KAAK,CAAC"}