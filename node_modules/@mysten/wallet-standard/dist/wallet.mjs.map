{"version":3,"file":"wallet.mjs","names":[],"sources":["../src/wallet.ts"],"sourcesContent":["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { bcs } from '@mysten/sui/bcs';\nimport { Transaction } from '@mysten/sui/transactions';\nimport { fromBase64, toBase64 } from '@mysten/sui/utils';\nimport type { WalletWithFeatures } from '@wallet-standard/core';\n\nimport type {\n\tSuiSignAndExecuteTransactionInput,\n\tSuiSignTransactionInput,\n\tSuiWalletFeatures,\n} from './features/index.js';\n\ndeclare module '@wallet-standard/core' {\n\texport interface Wallet {\n\t\t/**\n\t\t * Unique identifier of the Wallet.\n\t\t *\n\t\t * If not provided, the wallet name will be used as the identifier.\n\t\t */\n\t\treadonly id?: string;\n\t}\n\n\texport interface StandardConnectOutput {\n\t\tsupportedIntents?: string[];\n\t}\n}\n\nexport type { Wallet } from '@wallet-standard/core';\n\nexport async function signAndExecuteTransaction(\n\twallet: WalletWithFeatures<Partial<SuiWalletFeatures>>,\n\tinput: SuiSignAndExecuteTransactionInput,\n) {\n\tif (wallet.features['sui:signAndExecuteTransaction']) {\n\t\treturn wallet.features['sui:signAndExecuteTransaction'].signAndExecuteTransaction(input);\n\t}\n\n\tif (!wallet.features['sui:signAndExecuteTransactionBlock']) {\n\t\tthrow new Error(\n\t\t\t`Provided wallet (${wallet.name}) does not support the signAndExecuteTransaction feature.`,\n\t\t);\n\t}\n\n\tconst { signAndExecuteTransactionBlock } = wallet.features['sui:signAndExecuteTransactionBlock'];\n\n\tconst transactionBlock = Transaction.from(await input.transaction.toJSON());\n\tconst { digest, rawEffects, rawTransaction } = await signAndExecuteTransactionBlock({\n\t\taccount: input.account,\n\t\tchain: input.chain,\n\t\ttransactionBlock,\n\t\toptions: {\n\t\t\tshowRawEffects: true,\n\t\t\tshowRawInput: true,\n\t\t},\n\t});\n\n\tconst [\n\t\t{\n\t\t\ttxSignatures: [signature],\n\t\t\tintentMessage: { value: bcsTransaction },\n\t\t},\n\t] = bcs.SenderSignedData.parse(fromBase64(rawTransaction!));\n\n\tconst bytes = bcs.TransactionData.serialize(bcsTransaction).toBase64();\n\n\treturn {\n\t\tdigest,\n\t\tsignature,\n\t\tbytes,\n\t\teffects: toBase64(new Uint8Array(rawEffects!)),\n\t};\n}\n\nexport async function signTransaction(\n\twallet: WalletWithFeatures<Partial<SuiWalletFeatures>>,\n\tinput: SuiSignTransactionInput,\n) {\n\tif (wallet.features['sui:signTransaction']) {\n\t\treturn wallet.features['sui:signTransaction'].signTransaction(input);\n\t}\n\n\tif (!wallet.features['sui:signTransactionBlock']) {\n\t\tthrow new Error(\n\t\t\t`Provided wallet (${wallet.name}) does not support the signTransaction feature.`,\n\t\t);\n\t}\n\n\tconst { signTransactionBlock } = wallet.features['sui:signTransactionBlock'];\n\n\tconst transaction = Transaction.from(await input.transaction.toJSON());\n\tconst { transactionBlockBytes, signature } = await signTransactionBlock({\n\t\ttransactionBlock: transaction,\n\t\taccount: input.account,\n\t\tchain: input.chain,\n\t});\n\n\treturn { bytes: transactionBlockBytes, signature };\n}\n"],"mappings":";;;;;AA+BA,eAAsB,0BACrB,QACA,OACC;AACD,KAAI,OAAO,SAAS,iCACnB,QAAO,OAAO,SAAS,iCAAiC,0BAA0B,MAAM;AAGzF,KAAI,CAAC,OAAO,SAAS,sCACpB,OAAM,IAAI,MACT,oBAAoB,OAAO,KAAK,2DAChC;CAGF,MAAM,EAAE,mCAAmC,OAAO,SAAS;CAE3D,MAAM,mBAAmB,YAAY,KAAK,MAAM,MAAM,YAAY,QAAQ,CAAC;CAC3E,MAAM,EAAE,QAAQ,YAAY,mBAAmB,MAAM,+BAA+B;EACnF,SAAS,MAAM;EACf,OAAO,MAAM;EACb;EACA,SAAS;GACR,gBAAgB;GAChB,cAAc;GACd;EACD,CAAC;CAEF,MAAM,CACL,EACC,cAAc,CAAC,YACf,eAAe,EAAE,OAAO,sBAEtB,IAAI,iBAAiB,MAAM,WAAW,eAAgB,CAAC;AAI3D,QAAO;EACN;EACA;EACA,OALa,IAAI,gBAAgB,UAAU,eAAe,CAAC,UAAU;EAMrE,SAAS,SAAS,IAAI,WAAW,WAAY,CAAC;EAC9C;;AAGF,eAAsB,gBACrB,QACA,OACC;AACD,KAAI,OAAO,SAAS,uBACnB,QAAO,OAAO,SAAS,uBAAuB,gBAAgB,MAAM;AAGrE,KAAI,CAAC,OAAO,SAAS,4BACpB,OAAM,IAAI,MACT,oBAAoB,OAAO,KAAK,iDAChC;CAGF,MAAM,EAAE,yBAAyB,OAAO,SAAS;CAGjD,MAAM,EAAE,uBAAuB,cAAc,MAAM,qBAAqB;EACvE,kBAFmB,YAAY,KAAK,MAAM,MAAM,YAAY,QAAQ,CAAC;EAGrE,SAAS,MAAM;EACf,OAAO,MAAM;EACb,CAAC;AAEF,QAAO;EAAE,OAAO;EAAuB;EAAW"}